---
title: '节点搭建备份'
date: 2025-02-12T16:00:37+08:00
draft: true
slug: 0edc7a8
description:
summary:
tags:
  - ss
categories:
  - 实用教程
cover:
---

## Shadowsocks with ShadowTLS V3
### 2022 密码生成

```bash
# 2022-blake3-aes-128-gcm
openssl rand  -base64 16
# 2022-blake3-aes-256-gcm
openssl rand  -base64 32
```

### compose 文件

```bash
mkdir -p /opt/ss-rust/config && \
touch /opt/ss-rust/compose.yml /opt/ss-rust/config/config.json
```



```yaml
version: '3'
services:
    shadowsocks-rust:
        image: teddysun/shadowsocks-rust
        volumes:
            - ./config:/etc/shadowsocks-rust
        restart: always
        container_name: ss-rust
        ports:
            - 9000:9000/udp
            - 9000:9000

    shadow-tls:
        image: ghcr.io/ihciah/shadow-tls:latest
        container_name: shadow-tls
        restart: always
        network_mode: "host"
        environment:
            - MODE=server
            - V3=1
            - LISTEN=0.0.0.0:8443
            - SERVER=127.0.0.1:9000 # ss端口
            - TLS=mp.weixin.qq.com:443
            - PASSWORD=7x9Lm3pQr2Z8vB1tK4sN
```

### SS 配置

```json
{
    "server":"0.0.0.0",
    "server_port":9000,
    "password":"smg4HFXouAHGrQv5etdhlA==",
    "timeout":300,
    "method":"2022-blake3-aes-128-gcm",
    "nameserver":"127.0.0.1",
    "mode":"tcp_and_udp"
}
```

### UDP 转发

```bash
sudo iptables -t nat -A PREROUTING -p udp --dport 8443 -j REDIRECT --to-port 9000
sudo iptables -t nat -A OUTPUT -p udp --dport 8443 -j REDIRECT --to-port 9000

```

将 `ShadowTLS 8443` 端口的 `UDP` 流量转发到 `SS 9000` 端口。

持久化配置：

```bash
sudo apt-get update
sudo apt-get install iptables-persistent
```

删除 iptables 规则：

```bash
sudo iptables -t nat -D PREROUTING -p udp --dport 8443 -j REDIRECT --to-port 9000
sudo iptables -t nat -D OUTPUT -p udp --dport 8443 -j REDIRECT --to-port 9000
sudo netfilter-persistent save
```

## Snell with ShadowTLS V3

### compose 文件

```bash
mkdir -p /opt/snell/config && \
touch /opt/snell/compose.yml /opt/snell/config/snell.conf
```



```yaml
version: "3" 
services:
  snell:
    image: accors/snell:latest
    container_name: snell
    restart: always
    network_mode: host
    volumes:
      - ./config/snell.conf:/etc/snell-server.conf
    environment:
      - SNELL_URL=https://dl.nssurge.com/snell/snell-server-v4.1.1-linux-amd64.zip
  shadow-tls:
    image: ghcr.io/ihciah/shadow-tls:latest
      container_name: shadow-tls
      restart: always
      network_mode: "host"
      environment:
        - MODE=server
        - V3=1
        - LISTEN=0.0.0.0:8443
        - SERVER=127.0.0.1:9000 # snell端口
        - TLS=mp.weixin.qq.com:443
        - PASSWORD=7x9Lm3pQr2Z8vB1tK4sN
```

### Snell 配置

```ini
[snell-server]
listen = 0.0.0.0:9000
psk = 7x9Lm3pQr2Z8vB1tK4sN
ipv6 = false
```

## 补充

- [Services that Support TLS1.3](https://github.com/ihciah/shadow-tls/wiki/V3-Protocol#services-that-support-tls13)
- `IPV6` 监听地址对应：

| IPV4        | IPV6    |
| ----------- | ------- |
| `0.0.0.0`   | `[::]`  |
| `127.0.0.1` | `[::1]` |



## 参考

- [Shadowsocks+shadow-tls UDP转发](https://blog.lalalayyds.top/archives/1709125553492)
